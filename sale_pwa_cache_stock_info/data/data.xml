<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data noupdate="1">

        <!-- ONCHANGE -->

        <function model="ir.model.data" name="_update_xmlids">
            <value model="base" eval="[{
                'xml_id': 'sale_pwa_cache_stock_info.sale.order.line.field.product_id',
                'record': obj().env['ir.model.fields'].search([('model_id', '=', obj().env.ref('sale.model_sale_order_line').id), ('name', '=', 'product_id')], limit=1),
                'noupdate': False,
            }]"/>
        </function>

        <record id="pwa_cache_onchange_sale_order_line_product_id" model="pwa.cache">
            <field name="name">Sale Order Line - Onchange - product_id (Today) [Stock Info]</field>
            <field name="cache_type">onchange</field>
            <field name="model_id" ref="sale.model_sale_order_line"/>
            <field name="onchange_field" ref="sale_pwa_cache_secondary_unit.sale.order.line.field.product_id"/>
            <field name="code"><![CDATA[
today = datetime.datetime.today().strftime(DEFAULT_SERVER_DATE_FORMAT)
params = [
    {
        'product_id': product_id,
        'product_type': None,
        'virtual_available_at_date': None,
        'qty_available_today': None,
        'free_qty_today': None,
        'scheduled_date': None,
        'warehouse_id': None,
        'qty_to_deliver': None,
        'is_mto': None,
        'display_qty_widget': None,
    } for product_id in env['product.product'].search([]).ids
]
            ]]></field>
        </record>

    </data>
</odoo>
