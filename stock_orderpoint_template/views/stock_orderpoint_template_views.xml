<?xml version="1.0" encoding="utf-8" ?>
<!--
  Copyright 2024 Akretion (http://www.akretion.com).
  @author Florian Mounier <florian.mounier@akretion.com>
  License AGPL-3.0 or later (http://www.gnu.org/licenses/agpl).
-->
<odoo>
  <record id="sequence_mrp_op" model="ir.sequence">
    <field name="name">Stock orderpoint template</field>
    <field name="code">stock.orderpoint.template</field>
    <field name="prefix">OPTMPL/</field>
    <field name="padding">5</field>
    <field name="number_next">1</field>
    <field name="number_increment">1</field>
    <field name="company_id" />
  </record>

  <record id="view_stock_warehouse_orderpoint_template_kanban" model="ir.ui.view">
    <field name="name">stock.warehouse.orderpoint.template.kanban</field>
    <field name="model">stock.warehouse.orderpoint.template</field>
    <field name="arch" type="xml">
      <kanban class="o_kanban_mobile">
        <field name="name" />
        <field name="location_id" />
        <field name="product_min_qty" />
        <field name="product_max_qty" />
        <templates>
          <t t-name="kanban-box">
            <div t-attf-class="oe_kanban_global_click">
              <div class="o_kanban_record_top">
                <div class="o_kanban_record_headings">
                  <strong class="o_kanban_record_title">
                    <t t-esc="record.name.value" />
                  </strong>
                </div>
                <span class="badge badge-pill">
                  <strong>Min qty :</strong>
                  <t t-esc="record.product_min_qty.value" />
                </span>
              </div>
              <div class="o_kanban_record_bottom">
                <div class="oe_kanban_bottom_left">
                  <span>
                    <t t-esc="record.product_id.value" />
                  </span>
                </div>
                <div class="oe_kanban_bottom_right">
                  <span class="badge badge-pill">
                    <strong>Max qty :</strong>
                    <t t-esc="record.product_max_qty.value" />
                  </span>
                </div>
              </div>
            </div>
          </t>
        </templates>
      </kanban>
    </field>
  </record>

  <record id="view_warehouse_orderpoint_template_tree_editable" model="ir.ui.view">
    <field name="name">stock.warehouse.orderpoint.template.tree</field>
    <field name="model">stock.warehouse.orderpoint.template</field>
    <field name="arch" type="xml">
      <tree>
        <field name="name" />
        <field name="location_id" options="{'no_create': True}" />
        <field
                    name="warehouse_id"
                    options="{'no_create': True}"
                    groups="stock.group_stock_multi_warehouses"
                    optional="hide"
                />
        <field name="group_id" optional="hide" groups="stock.group_adv_location" />
        <field name="product_min_qty" optional="show" />
        <field name="product_max_qty" optional="show" />
        <field name="qty_multiple" optional="hide" />
        <field
                    name="company_id"
                    optional="hide"
                    readonly="1"
                    groups="base.group_multi_company"
                />
      </tree>
    </field>
  </record>

  <record model="ir.ui.view" id="warehouse_orderpoint_template_search">
    <field name="name">stock.warehouse.orderpoint.template.search</field>
    <field name="model">stock.warehouse.orderpoint.template</field>
    <field name="arch" type="xml">
      <search string="Reordering Rule Templates Search">
        <field name="name" string="Reordering Rule Template" />
        <field name="location_id" />
        <field name="group_id" groups="stock.group_adv_location" />
        <field name="warehouse_id" groups="stock.group_stock_multi_warehouses" />
        <group expand="0" string="Group By">
          <filter
                        string="Warehouse"
                        name="warehouse"
                        domain="[]"
                        context="{'group_by': 'warehouse_id'}"
                        groups="stock.group_stock_multi_warehouses"
                    />
          <filter
                        string="Location"
                        name="location"
                        domain="[]"
                        context="{'group_by': 'location_id'}"
                    />
        </group>
      </search>
    </field>
  </record>

  <record model="ir.actions.act_window" id="action_open_orderpoints">
    <field name="name">Template Orderpoints</field>
    <field name="res_model">stock.warehouse.orderpoint</field>
    <field name="type">ir.actions.act_window</field>
    <field name="view_mode">tree,kanban,form</field>
    <field name="view_id" ref="stock.view_warehouse_orderpoint_tree_editable_config" />
    <field name="search_view_id" ref="stock.warehouse_orderpoint_search" />
    <field name="context">{}</field>
    <field name="domain">[('template_id', '=', active_id)]</field>
  </record>

  <record id="view_warehouse_orderpoint_template_form" model="ir.ui.view">
    <field name="name">stock.warehouse.orderpoint.template.form</field>
    <field name="model">stock.warehouse.orderpoint.template</field>
    <field name="arch" type="xml">
      <form string="Reordering Rule Templates">
        <sheet>
          <div class="oe_button_box" name="button_box">
            <button
                            name="%(action_open_orderpoints)d"
                            type="action"
                            class="oe_stat_button"
                            icon="fa-cubes"
                        >
              <field
                                name="orderpoints_count"
                                widget="statinfo"
                                string="Reordering Rules"
                            />
            </button>
          </div>
          <div class="oe_title">
            <h1>
              <field name="name" />
            </h1>
          </div>
          <group>
            <group>
              <field name="allowed_location_ids" invisible="1" />
              <field name="warehouse_id" widget="selection" />
              <field
                                name="location_id"
                                options="{'no_create': True}"
                                domain="[('id', 'in', allowed_location_ids)]"
                            />
              <label for="group_id" groups="base.group_no_one" />
              <div groups="base.group_no_one">
                <field name="group_id" groups="stock.group_adv_location" />
              </div>
              <field
                                name="company_id"
                                groups="base.group_multi_company"
                                options="{'no_create': True}"
                            />
            </group>
            <group>
              <label for="product_min_qty" />
              <div class="o_row">
                <field name="product_min_qty" />
              </div>
              <label for="product_max_qty" />
              <div class="o_row">
                <field name="product_max_qty" />
              </div>
              <field name="qty_multiple" string="Quantity Multiple" />
            </group>
          </group>
        </sheet>
      </form>
    </field>
  </record>

  <record id="action_orderpoint_template" model="ir.actions.act_window">
    <field name="name">Reordering Rule Templates</field>
    <field name="res_model">stock.warehouse.orderpoint.template</field>
    <field name="type">ir.actions.act_window</field>
    <field name="view_mode">tree,kanban,form</field>
    <field name="view_id" ref="view_warehouse_orderpoint_template_tree_editable" />
    <field name="search_view_id" ref="warehouse_orderpoint_template_search" />
    <field name="help" type="html">
      <p class="o_view_nocontent_smiling_face">
        No reordering rule template found
      </p>
    </field>
  </record>

  <menuitem
        id="menu_reordering_rule_template_config"
        action="action_orderpoint_template"
        groups="stock.group_stock_multi_locations"
        name="Reordering Rule Templates"
        parent="stock.menu_product_in_config_stock"
        sequence="10"
    />
</odoo>
